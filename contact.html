<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Contact Us. | Curam-Ai Protocol‚Ñ¢</title>
    <meta
      name="description"
      content="Get in touch with Curam-Ai. Book a diagnostic call, start a Feasibility Sprint, or ask our AI assistant about document automation solutions."
    />
    <link rel="icon" type="image/png" href="assets/images/curam-ai-logo.png" />
    <link rel="stylesheet" href="assets/css/styles.css" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;500;600;700;800&display=swap"
      rel="stylesheet"
    />
  </head>
  <body>
    <!-- Scroll Down Button -->
    <button class="scroll-down-btn" aria-label="Scroll down">
      <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M12 5v14M19 12l-7 7-7-7" />
      </svg>
    </button>

    <!-- Navigation -->
    <div id="navbar-placeholder"></div>
    <script src="assets/js/navbar-loader.js"></script>

    <!-- Page Header / Hero -->
    <section class="hero contact-hero">
      <div class="hero-background">
        <div class="hero-gradient"></div>
        <div class="hero-pattern"></div>
      </div>
      <div class="container">
        <div class="hero-content">
          <p class="hero-eyebrow">Get Started</p>
          <h1 class="hero-headline">Let's Start the Conversation</h1>
          <p class="hero-subhead">
            Book a diagnostic call or start with a Feasibility Sprint
          </p>
        </div>
      </div>
    </section>

    <!-- Contact Sections (Light Background) -->
    <div class="contact-sections">
      <!-- Combined AI Assistant + Contact Form Section -->
      <section class="contact-section">
        <div class="container">
          <div class="contact-two-col">
            <!-- AI Assistant -->
            <div class="contact-ai-assistant-container">
              <div class="contact-ai-assistant-box">
                <div class="contact-ai-header">
                  <h3>AI Inquiry Assistant</h3>
                  <span class="contact-ai-tag">AI</span>
                </div>
                <p class="contact-ai-intro">
                  Not sure where to start? Ask me about your document automation needs, and I'll help guide you to the
                  right solution.
                </p>
                <div class="contact-chat-window" id="chatContainer">
                  <div class="contact-chat-msg assistant">
                    <div class="contact-msg-bubble">
                      Hi! I'm here to help you find the right document automation solution. What challenges are you facing
                      with document processing?
                    </div>
                  </div>
                </div>
                <div class="contact-chat-input-row">
                  <input
                    type="text"
                    class="contact-chat-field"
                    id="chatInput"
                    placeholder="Ask about invoice automation, beam schedules, or our protocol..."
                  />
                  <button class="contact-chat-btn" id="chatSendBtn">Send</button>
                </div>
                <div id="suggestedInterest" class="contact-interest-suggestion contact-hidden"></div>

                <!-- Email Chat Log Section -->
                <div class="contact-email-section contact-hidden" id="emailChatSection">
                  <p class="contact-email-section-title">üìß Email this conversation</p>
                  <p class="contact-email-section-desc">
                    Get a copy of our conversation sent to your email for your records.
                  </p>
                  <div class="contact-email-form-row">
                    <div class="contact-email-field-group">
                      <label for="emailInput">Your Email Address</label>
                      <input type="email" class="contact-email-field" id="emailInput" placeholder="your.email@example.com" />
                    </div>
                    <button class="contact-email-btn" id="emailChatBtn">Send Email</button>
                  </div>
                  <div id="emailStatus"></div>
                </div>
              </div>
            </div>

            <!-- Contact Form -->
            <div class="contact-form-box">
              <h2>Contact Us</h2>
              <form id="contactForm" action="#" method="POST">
                <div class="contact-form-field">
                  <label for="name">Full Name *</label>
                  <input type="text" id="name" name="name" required />
                </div>

                <div class="contact-form-field">
                  <label for="email">Email Address *</label>
                  <input type="email" id="email" name="email" required />
                </div>

                <div class="contact-form-field">
                  <label for="company">Company Name</label>
                  <input type="text" id="company" name="company" />
                </div>

                <div class="contact-form-field">
                  <label for="interest">I'm interested in:</label>
                  <select id="interest" name="interest">
                    <option value="">Select an option</option>
                    <option value="phase-1">Phase 1 - Feasibility Sprint ($1,500)</option>
                    <option value="phase-2">Phase 2 - The Roadmap ($7,500)</option>
                    <option value="phase-3">Phase 3 - Compliance Shield ($8-12k)</option>
                    <option value="phase-4">Phase 4 - Implementation ($20-30k)</option>
                    <option value="roi">ROI Calculator</option>
                    <option value="general">General Inquiry</option>
                  </select>
                </div>

                <div class="contact-form-field">
                  <label for="message">Message *</label>
                  <textarea
                    id="message"
                    name="message"
                    required
                    placeholder="Tell us about your current challenges or what you'd like to learn more about..."
                  ></textarea>
                  <div id="message-relevance-warning" class="message-relevance-warning contact-hidden">
                    <strong>‚ö†Ô∏è Note:</strong> Your message doesn't appear to be related to our services (document automation, AI implementation, structural engineering workflows, or the Curam-Ai Protocol). We may not be able to assist with your inquiry. Please consider if your question relates to our services before submitting.
                  </div>
                </div>

                <div class="contact-form-submit">
                  <button type="submit" class="btn btn-primary">Send Message</button>
                  <div id="form-message" class="form-message contact-hidden"></div>
                </div>
              </form>
            </div>
          </div>
        </div>
      </section>

      <!-- Alternative Contact Methods -->
      <section class="contact-section">
        <div class="container">
          <h2 class="section-headline">Other Ways to Reach Us</h2>
          <div class="contact-alt-grid">
            <div class="contact-alt-card">
              <h3>Book a Call</h3>
              <p>Schedule a 30-minute diagnostic call to discuss your needs.</p>
              <a href="#" class="btn btn-secondary">Schedule Now</a>
            </div>
            <div class="contact-alt-card">
              <h3>Calculate ROI</h3>
              <p>Use our ROI calculator to understand the financial impact.</p>
              <a href="roi.html" class="btn btn-secondary">Open Calculator</a>
            </div>
          </div>
        </div>
      </section>
    </div>

    <!-- Footer -->
    <footer class="footer">
      <div class="container">
        <div class="footer-content">
          <div class="footer-brand">
            <img src="assets/images/curam-ai-logo.png" alt="Curam-Ai" class="logo-image" />
            <span class="logo-text">Curam-Ai</span>
            <p class="footer-tagline">The Curam-Ai Protocol‚Ñ¢</p>
          </div>
          <div class="footer-links">
            <div class="footer-column">
              <h4>Services</h4>
              <ul>
                <li><a href="services.html#service-1">Document Intelligence</a></li>
                <li><a href="services.html#service-2">Enterprise RAG Systems</a></li>
                <li><a href="services.html#service-3">Workflow Automation</a></li>
                <li><a href="services.html#service-4">AI Strategy</a></li>
              </ul>
            </div>
            <div class="footer-column">
              <h4>The Protocol</h4>
              <ul>
                <li><a href="curam-ai-protocol.html">Phase 1: Feasibility Sprint</a></li>
                <li><a href="curam-ai-protocol.html">Phase 2: The Roadmap</a></li>
                <li><a href="curam-ai-protocol.html">Phase 3: Compliance Shield</a></li>
                <li><a href="curam-ai-protocol.html">Phase 4: Implementation</a></li>
              </ul>
            </div>
            <div class="footer-column">
              <h4>Resources</h4>
              <ul>
                <li><a href="roi.html">ROI Calculator</a></li>
                <li><a href="how-it-works.html">Technical Architecture</a></li>
                <li><a href="faq.html">FAQ</a></li>
                <li><a href="target-markets.html">Target Markets</a></li>
              </ul>
            </div>
            <div class="footer-column">
              <h4>Company</h4>
              <ul>
                <li><a href="about.html">About</a></li>
                <li><a href="contact.html">Contact</a></li>
                <li><a href="case-study.html">Case Studies</a></li>
              </ul>
            </div>
          </div>
        </div>
        <div class="footer-bottom">
          <p>&copy; 2025 Curam-Ai. All rights reserved. | <a href="sitemap.html">Sitemap</a></p>
        </div>
      </div>
    </footer>

    <script src="assets/js/scripts.js"></script>
    <script>
      // AI Contact Assistant
      const chatContainer = document.getElementById('chatContainer');
      const chatInput = document.getElementById('chatInput');
      const chatSendBtn = document.getElementById('chatSendBtn');
      const suggestedInterestDiv = document.getElementById('suggestedInterest');
      const interestSelect = document.getElementById('interest');
      const messageTextarea = document.getElementById('message');

      let conversationHistory = [];
      let audioContext = null;

      // Initialize audio context on first user interaction
      function initAudioContext() {
          if (!audioContext) {
              try {
                  audioContext = new (window.AudioContext || window.webkitAudioContext)();
              } catch (error) {
                  console.log('Could not initialize audio context:', error);
              }
          }
          // Resume audio context if it's suspended (required by some browsers)
          if (audioContext && audioContext.state === 'suspended') {
              audioContext.resume();
          }
      }

      // Function to play notification sound when AI responds
      function playNotificationSound() {
          try {
              // Ensure audio context is initialized
              if (!audioContext) {
                  initAudioContext();
              }
              
              if (!audioContext) return;
              
              // Resume if suspended
              if (audioContext.state === 'suspended') {
                  audioContext.resume();
              }
              
              // Create a pleasant notification sound (gentle chime)
              const oscillator = audioContext.createOscillator();
              const gainNode = audioContext.createGain();
              
              oscillator.connect(gainNode);
              gainNode.connect(audioContext.destination);
              
              // Set frequency for a pleasant tone (gentle descending chime)
              oscillator.frequency.setValueAtTime(800, audioContext.currentTime);
              oscillator.frequency.exponentialRampToValueAtTime(600, audioContext.currentTime + 0.1);
              
              // Set volume envelope (fade in and out)
              gainNode.gain.setValueAtTime(0, audioContext.currentTime);
              gainNode.gain.linearRampToValueAtTime(0.3, audioContext.currentTime + 0.01);
              gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.2);
              
              // Use a sine wave for a smooth, pleasant sound
              oscillator.type = 'sine';
              
              oscillator.start(audioContext.currentTime);
              oscillator.stop(audioContext.currentTime + 0.2);
          } catch (error) {
              // Silently fail if audio context is not available (e.g., autoplay restrictions)
              console.log('Could not play notification sound:', error);
          }
      }

      function sanitizeHtml(html) {
          // Parse the HTML safely using DOMParser
          const parser = new DOMParser();
          const doc = parser.parseFromString(html, 'text/html');
          
          // Remove dangerous elements
          const dangerous = doc.querySelectorAll('script, style, iframe, object, embed, form, input, button, link, meta');
          dangerous.forEach(el => el.remove());
          
          // Remove dangerous attributes from all elements
          const allElements = doc.querySelectorAll('*');
          allElements.forEach(el => {
              // Remove all attributes except safe ones
              Array.from(el.attributes).forEach(attr => {
                  const attrName = attr.name.toLowerCase();
                  if (attrName === 'href' && el.tagName === 'A') {
                      // Only allow http/https links
                      if (!attr.value.match(/^https?:\/\//i)) {
                          el.removeAttribute(attrName);
                      }
                  } else if (!['class', 'id'].includes(attrName)) {
                      el.removeAttribute(attrName);
                  }
              });
          });
          
          // Get sanitized HTML
          return doc.body.innerHTML;
      }
      
      function addMessageToChat(role, content) {
          const messageDiv = document.createElement('div');
          messageDiv.className = `contact-chat-msg ${role}`;
          
          // If content doesn't contain HTML tags, format it
          let formattedContent = content;
          if (!content.includes('<') || !content.includes('>')) {
              // Convert plain text to HTML
              formattedContent = formatTextToHtml(content);
          } else {
              // Sanitize existing HTML
              formattedContent = sanitizeHtml(content);
          }
          
          messageDiv.innerHTML = `<div class="contact-msg-bubble">${formattedContent}</div>`;
          chatContainer.appendChild(messageDiv);
          chatContainer.scrollTop = chatContainer.scrollHeight;

          // Add to conversation history (store original content)
          conversationHistory.push({ role, content });

          // Play sound when assistant responds
          if (role === 'assistant') {
              playNotificationSound();
          }
      }
      
      function formatTextToHtml(text) {
          if (!text) return '';
          
          // Split by double newlines (paragraphs)
          const paragraphs = text.split(/\n\s*\n/).filter(p => p.trim());
          
          if (paragraphs.length === 0) {
              return `<p>${escapeHtml(text)}</p>`;
          }
          
          let html = '';
          for (const para of paragraphs) {
              const trimmed = para.trim();
              if (!trimmed) continue;
              
              // Replace single newlines with <br>
              let formatted = trimmed.replace(/\n/g, '<br>');
              
              // Basic markdown-style formatting
              formatted = formatted.replace(/\*\*([^*]+)\*\*/g, '<strong>$1</strong>');
              formatted = formatted.replace(/\*([^*]+)\*/g, '<em>$1</em>');
              
              html += `<p>${formatted}</p>`;
          }
          
          return html || `<p>${escapeHtml(text)}</p>`;
      }
      
      function escapeHtml(text) {
          const div = document.createElement('div');
          div.textContent = text;
          return div.innerHTML;
      }

      function showSuggestedInterest(suggestedInterest) {
          if (!suggestedInterest) {
              suggestedInterestDiv.classList.add('contact-hidden');
              return;
          }

          const interestLabels = {
              'phase-1': 'Phase 1 - Feasibility Sprint ($1,500)',
              'phase-2': 'Phase 2 - The Roadmap ($7,500)',
              'phase-3': 'Phase 3 - Compliance Shield ($8-12k)',
              'phase-4': 'Phase 4 - Implementation ($20-30k)',
              'roi': 'ROI Calculator'
          };

          suggestedInterestDiv.innerHTML = `
              <strong>üí° Suggested:</strong> Based on our conversation, you might be interested in
              <strong>${interestLabels[suggestedInterest] || suggestedInterest}</strong>.
              <a href="#" onclick="document.getElementById('interest').value='${suggestedInterest}'; return false;">Apply to form</a>
          `;
          suggestedInterestDiv.classList.remove('contact-hidden');
      }

      async function sendChatMessage() {
          const message = chatInput.value.trim();
          if (!message) return;

          // Add user message to chat
          addMessageToChat('user', message);
          chatInput.value = '';
          const originalBtnContent = chatSendBtn.innerHTML;
          chatSendBtn.disabled = true;
          chatSendBtn.innerHTML = '<span class="contact-loading-spin"></span>';

          try {
              const response = await fetch('/api/contact-assistant', {
                  method: 'POST',
                  headers: {
                      'Content-Type': 'application/json',
                  },
                  body: JSON.stringify({
                      message: message,
                      history: conversationHistory
                  })
              });

              const data = await response.json();

              if (data.error) {
                  addMessageToChat('assistant', "I'm sorry, I encountered an error. Please feel free to fill out the form below or contact us directly.");
              } else {
                  addMessageToChat('assistant', data.message);

                  // Show suggested interest if provided
                  if (data.suggested_interest) {
                      showSuggestedInterest(data.suggested_interest);
                  }

                  // Show email section after at least 2 messages (user + assistant)
                  if (conversationHistory.length >= 2) {
                      document.getElementById('emailChatSection').classList.remove('contact-hidden');
                  }
              }
          } catch (error) {
              console.error('Chat error:', error);
              addMessageToChat('assistant', "I'm having trouble connecting right now. Please fill out the form below and we'll get back to you.");
          } finally {
              chatSendBtn.disabled = false;
              chatSendBtn.innerHTML = originalBtnContent || 'Send';
          }
      }

      // Email chat log functionality
      const emailChatBtn = document.getElementById('emailChatBtn');
      const emailInput = document.getElementById('emailInput');
      const emailStatus = document.getElementById('emailStatus');
      const nameInput = document.getElementById('name');
      const companyInput = document.getElementById('company');

      // Pre-fill email from form if available
      const emailFormInput = document.getElementById('email');
      if (emailFormInput) {
          emailFormInput.addEventListener('blur', function() {
              if (this.value && !emailInput.value) {
                  emailInput.value = this.value;
              }
          });
      }

      emailChatBtn.addEventListener('click', async function() {
          const email = emailInput.value.trim();
          if (!email) {
              emailStatus.innerHTML = '<div class="contact-email-err">Please enter your email address.</div>';
              return;
          }

          if (conversationHistory.length === 0) {
              emailStatus.innerHTML = '<div class="contact-email-err">No conversation to email.</div>';
              return;
          }

          emailChatBtn.disabled = true;
          emailChatBtn.textContent = 'Sending...';
          emailStatus.innerHTML = '';

          try {
              const response = await fetch('/api/email-chat-log', {
                  method: 'POST',
                  headers: {
                      'Content-Type': 'application/json',
                  },
                  body: JSON.stringify({
                      email: email,
                      history: conversationHistory,
                      name: nameInput ? nameInput.value.trim() : '',
                      company: companyInput ? companyInput.value.trim() : ''
                  })
              });

              const data = await response.json();

              if (data.error) {
                  emailStatus.innerHTML = `<div class="contact-email-err">Error: ${data.error}</div>`;
              } else {
                  emailStatus.innerHTML = '<div class="contact-email-ok">‚úì Chat log sent successfully! Check your email.</div>';
                  emailInput.value = '';
              }
          } catch (error) {
              console.error('Email error:', error);
              emailStatus.innerHTML = '<div class="email-err">Failed to send email. Please try again later.</div>';
          } finally {
              emailChatBtn.disabled = false;
              emailChatBtn.textContent = 'Send Email';
          }
      });

      // Initialize audio context on first user interaction
      chatSendBtn.addEventListener('click', function() {
          initAudioContext();
          sendChatMessage();
      });
      chatInput.addEventListener('keydown', (e) => {
          if (e.key === 'Enter') {
              initAudioContext();
              sendChatMessage();
          }
      });
      
      // Also initialize on any click in the chat area (for better browser compatibility)
      chatInput.addEventListener('focus', initAudioContext);

      // Message relevance validation using NLP (same as AI assistant)
      // Note: messageTextarea is already declared above
      const relevanceWarning = document.getElementById('message-relevance-warning');
      
      let relevanceCheckInProgress = false;
      let lastCheckedMessage = '';
      
      async function checkMessageRelevance(message) {
          if (!message || message.trim().length < 10) {
              return { isRelevant: true, confidence: 1.0, reason: 'Message too short to analyze' };
          }
          
          // Don't re-check the same message
          if (message === lastCheckedMessage && lastCheckedMessage !== '') {
              return null; // Use cached result
          }
          
          if (relevanceCheckInProgress) {
              return null; // Skip if check already in progress
          }
          
          relevanceCheckInProgress = true;
          lastCheckedMessage = message;
          
          try {
              const response = await fetch('/api/check-message-relevance', {
                  method: 'POST',
                  headers: {
                      'Content-Type': 'application/json',
                  },
                  body: JSON.stringify({ message: message })
              });
              
              const data = await response.json();
              
              return {
                  isRelevant: data.is_relevant !== false, // Default to true if not specified
                  confidence: data.confidence || 0.5,
                  reason: data.reason || 'Analyzed by AI'
              };
          } catch (error) {
              console.error('Relevance check error:', error);
              // On error, default to allowing submission
              return { isRelevant: true, confidence: 0.5, reason: 'Check unavailable' };
          } finally {
              relevanceCheckInProgress = false;
          }
      }
      
      async function updateRelevanceWarning() {
          if (!messageTextarea || !relevanceWarning) {
              console.error('Message textarea or relevance warning element not found');
              return;
          }
          
          const message = messageTextarea.value.trim();
          
          if (message.length < 10) {
              relevanceWarning.classList.add('contact-hidden');
              return;
          }
          
          try {
              const result = await checkMessageRelevance(message);
              
              if (result && !result.isRelevant && result.confidence < 0.7) {
                  // Show warning if not relevant and confidence is low
                  relevanceWarning.classList.remove('contact-hidden');
              } else {
                  relevanceWarning.classList.add('contact-hidden');
              }
          } catch (error) {
              console.error('Error updating relevance warning:', error);
              // On error, hide warning to not block user
              relevanceWarning.classList.add('contact-hidden');
          }
      }
      
      // Check relevance as user types (with debounce)
      let relevanceCheckTimeout;
      messageTextarea.addEventListener('input', function() {
          clearTimeout(relevanceCheckTimeout);
          relevanceCheckTimeout = setTimeout(updateRelevanceWarning, 1000); // 1 second debounce for API calls
      });
      
      // Also check on blur
      messageTextarea.addEventListener('blur', updateRelevanceWarning);
      
      // Form submission handler
      const formMessage = document.getElementById('form-message');
      
      function showFormMessage(message, isError = false) {
          formMessage.textContent = message;
          formMessage.className = 'form-message ' + (isError ? 'form-message-error' : 'form-message-success');
          formMessage.classList.remove('contact-hidden');
          
          // Scroll to message
          formMessage.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
          
          // Hide message after 5 seconds for success, keep error visible
          if (!isError) {
              setTimeout(() => {
                  formMessage.classList.add('contact-hidden');
              }, 5000);
          }
      }
      
      function hideFormMessage() {
          formMessage.classList.add('contact-hidden');
      }
      
      document.getElementById('contactForm').addEventListener('submit', async function(e) {
          e.preventDefault();
          
          const form = this;
          const submitBtn = form.querySelector('button[type="submit"]');
          const originalBtnText = submitBtn.textContent;
          
          // Hide previous messages
          hideFormMessage();
          
          // Get form data
          const formData = {
              name: document.getElementById('name').value.trim(),
              email: document.getElementById('email').value.trim(),
              company: document.getElementById('company').value.trim(),
              interest: document.getElementById('interest').value,
              message: document.getElementById('message').value.trim()
          };
          
          // Validation
          if (!formData.name || !formData.email || !formData.message) {
              showFormMessage('Please fill in all required fields (Name, Email, and Message).', true);
              return;
          }
          
          // Disable submit button early
          submitBtn.disabled = true;
          submitBtn.textContent = 'Checking...';
          
          // Check message relevance before submission using NLP
          if (formData.message.length > 10) {
              try {
                  const relevanceResult = await checkMessageRelevance(formData.message);
                  
                  if (relevanceResult && !relevanceResult.isRelevant && relevanceResult.confidence < 0.7) {
                      // Re-enable button for user decision
                      submitBtn.disabled = false;
                      submitBtn.textContent = originalBtnText;
                      
                      // Show warning but allow submission
                      const confirmSubmit = confirm(
                          'Your message doesn\'t appear to be related to our services (document automation, AI implementation, or structural engineering workflows). We may not be able to assist with your inquiry. Do you still want to submit?'
                      );
                      if (!confirmSubmit) {
                          return; // User cancelled submission
                      }
                      
                      // Disable again for submission
                      submitBtn.disabled = true;
                      submitBtn.textContent = 'Sending...';
                  }
              } catch (error) {
                  console.error('Relevance check failed on submit:', error);
                  // Continue with submission if check fails
              }
          }
          
          // Update button text if not already updated
          if (submitBtn.textContent !== 'Sending...') {
              submitBtn.textContent = 'Sending...';
          }
          
          try {
              const response = await fetch('/api/contact', {
                  method: 'POST',
                  headers: {
                      'Content-Type': 'application/json',
                  },
                  body: JSON.stringify(formData)
              });
              
              const data = await response.json();
              
              if (response.ok && data.success) {
                  // Show success message
                  showFormMessage(data.message || 'Thank you for your message! We will get back to you soon.', false);
                  form.reset();
              } else {
                  // Show error message
                  showFormMessage(data.error || 'Failed to send message. Please try again later.', true);
                  if (data.details) {
                      console.error('Error details:', data.details);
                  }
              }
          } catch (error) {
              console.error('Form submission error:', error);
              showFormMessage('An error occurred while sending your message. Please try again later.', true);
          } finally {
              // Re-enable submit button
              submitBtn.disabled = false;
              submitBtn.textContent = originalBtnText;
          }
      });
    </script>
  </body>
</html>
